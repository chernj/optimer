!function(t,i){"function"==typeof define&&define.amd?define(i):"object"==typeof exports?module.exports=i():t.optimer=i()}(this,function(){"use strict";function t(t){var i=(new Date).getTime();this.__={start:i,params:null,threshold:10,remain:null},this.clearTime;for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);"repeat"in this||(this.repeat=0),"interval"in this||(this.interval=this.end-i),"end"in this||(this.end=i+this.interval),"callback"in this||(this.callback=function(){this.elapsed()}),this.__.start=i,"delay"in this?this.delay>0?setTimeout(function(){this.running=!0,this.delay=void 0,e.call(this)},this.delay):(this.running=!0,e.call(this)):"running"in this?this.running&&e.call(this):this.running=!1}function i(){var t=(new Date).getTime();if(this.__.params){var i=this.__.params;for(var e in i)i.hasOwnProperty(e)&&(this[e]=i[e]);"end"in i||(this.end=t+this.interval),this.__.params=null}else this.end=t+this.interval;clearTimeout(this.clearTime),this.__.start=null}function e(){var t=this;this.__.start||(this.__.start=(new Date).getTime());var i=function(){var i=t.end-(new Date).getTime();return i>t.__.threshold&&(i*=.9),i},e=function(n){0>=n?t.fire({},!0):t.clearTime=setTimeout(function(){(new Date).getTime()>=t.end?(t.clearTime=void 0,t.fire({},!0)):e(i())},n)};e(i())}return t.prototype.play=function(){return this.running?this:(this.__.remain?(this.end=(new Date).getTime()+this.__.remain,this.__.remain=null):this.end=(new Date).getTime()+this.interval,this.running=!0,void e.call(this))},t.prototype.pause=function(){return this.running?(clearTimeout(this.clearTime),this.__.remain=this.end-(new Date).getTime(),void(this.running=!1)):this},t.prototype.reset=function(t,n){this.running=!1,t.length>0?this.__.params=t:this.__.params=null,i.call(this),n&&(this.running=!0,e.call(this))},t.prototype.fire=function(t,i){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);return 1==this.repeat||0==this.repeat?this.finish(t):(i?this.end+=this.interval:this.end=(new Date).getTime()+this.interval,this.repeat>0&&(this.repeat-=1),"obj"in this?this.args.length>1?this.callback.apply(this.obj,this.args):this.callback.call(this.obj,this.args):this.callback(this.args),clearTimeout(this.clearTime),this.running&&e.call(this)),this},t.prototype.alter=function(t){if(null===t)return this;var i=null;if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&("interval"===n?i="n"+t.interval.toString():"amount"===n?i=t.amount:this[n]=t[n]);else("string"==typeof t||"number"==typeof t)&&(i=t);if(i){if("string"==typeof i&&i.startsWith("n")&&(i=i.substring(1),i-=this.interval),i=+i,0==i)return this;this.end+=i,this.interval+=i,this.running&&0>i&&(clearTimeout(this.clearTime),e.call(this))}return this},t.prototype.finish=function(t){if(this.running||this.__.remain){if(this.running=!1,this.__.remain=null,clearTimeout(this.clearTime),this.repeat>0&&(this.repeat-=1),arguments.length>0)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);"obj"in this?this.args.length>1?this.callback.apply(this.obj,this.args):this.callback.call(this.obj,this.args):this.callback(this.args),this.__.start=null}},t.prototype.remaining=function(){return this.__.remain?this.__.remain:this.end-(new Date).getTime()},t.prototype.elapsed=function(){return this.__.start?(new Date).getTime()-this.__.start:null},t});